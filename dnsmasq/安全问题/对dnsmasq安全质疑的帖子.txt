原帖：http://www.right.com.cn/forum/forum.php?mod=viewthread&tid=219905&mobile=1
备份日期：2017-6-27 15:20 
————————————————————————————————
1# abccba94 发消息 只看他 
2017-6-27 10:01
本帖最后由 abccba94 于 2017-6-27 15:20 编辑 

一、何为Hosts

在互联网上，要访问一个站点，一般是通过域名访问（如http://www.baidu.com），但是在实际数据通讯时，我们是通过IP地址（如163.177.151.110）来进行数据交换，因此就有一个域名到IP的解析过程，我们把这个过程叫做DNS解析

这就像我们手机里的电话号码，域名对应名称（比如小王），IP地址对应电话号码（比如135xxxxxxxx）


DNS解析一般是通过运营商指定的DNS服务器来进行，但是由于众所周知的原因，当我们访问某些站点如（www.google.com）时，DNS服务器会随机返回一个垃圾IP地址，使你无法获得正确的google服务器的IP地址，我们把这个叫做域名污染。

于是有人想到一个方法，就是修改计算机或路由器本机的hosts文件获取正确IP，hosts文件用于直接指明域名与IP的对应关系，它不再需要经过DNS服务器进行解析。
比如在K2的Hosts中，我们可以看到这样的信息：
代码:
127.0.0.1 localhost
192.168.2.1 phicomm.me
192.168.2.1 p.to



hosts的第一列是IP地址，第二列是对应的域名，我们可看到K2把p.to域名指向了IP地址192.168.2.1，因此当我们在浏览器中输入http://p.to时，实际访问的是http://192.168.2.1，即K2的WEB管理页面。

二、你可能认为的Hosts扶墙原理

在几个月前，当我第一次听说Hosts扶墙时，我认为的原理是这样的：

1、通过在本机Hosts中指定域名和IP的对应关系，获取google等网站的真实IP地址，消除DNS污染

2、通过本机与真实IP进行通讯，从而实现扶墙

但是当我花了点时间进行分析时，发现这个是大错特错的

三、你可能不知道的GFW

首先我们来看看GFW做了哪些工作
我们通过计算机的ping命令来获取域名对应的IP：
 
可以看到，当我们ping google时，DNS服务器返回的是一个垃圾IP

我们再用pdnsd消除dns污染后，再ping：
 
此时，虽然计算机已经获取了google服务器的正确IP，但还是无法ping通的，GFW还是进行了拦截

因此我们可以确定：单纯知道google服务器的正确地址，也是无法扶墙的

GFW不仅对域名进行了污染，还对指定的IP地址段进行了数据干扰，同时还对一些关键字进行了截取和干扰，这也是gfwlist为何要用base64加密的原因，你直接拷贝明文的GFWList文件是拷贝不下来的

厉害了，我的GFW！

四、你需要知道的Hosts扶墙原理
本帖隐藏的内容
其实要想知道原理很简单，我们把所谓的Hosts列表(此列表用dnsmasq规则编写，等同于Hosts)拿来展示一下：
 

 
你发现了什么？！

在此hosts中将对google、youtube等站点的访问都指向了同一个IP地址！此IP地址是个什么东西呢？
 
它是香港PCCW机房的一个服务器，其实就是一个反向代理服务器，关于如何搭建反向代理可以参考【此文】，任何人有个VPS就可以搭建，

现在你知道了吧：
所谓的Hosts扶墙，是利用的反向代理，将你对gfw站点的请求，转发给一个不知名的代理，由这个代理再转发给GFW站点，你的流量都会经过此代理，有一定风险。

Hosts文件是系统很关键的一个文件，试想如果有人将关键网站的域名改成一个黑客的服务器IP，你的所有数据就会经过此服务器；
如果再进一步，搞一个钓鱼网站，你访问此网站就变成了访问钓鱼网站，你输入的账号、密码也都可能会被记录。

这就好像有人修改你的手机通讯录，将你关键联系人的电话号码改成另外一个号码一样的道理。



基于上面的分析，我是不推荐Hosts扶墙的，尤其是动态更新Hosts列表。

如果没有办法，请使用众所周知的Hosts列表，千万不要轻易尝试那些来源不明的Hosts文件（包括dnsmasq文件）！

最后，我想说的是，用Hosts扶墙真的还不如去找免费的$ $代理。